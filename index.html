<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>רשימת קניות</title>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      background: #fafafa;
      padding: 20px;
      margin: 0;
    }
    .cat {
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 14px;
    }
    .cat-header {
      font-weight: bold;
      padding: 6px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.12);
      cursor: pointer;
    }
    .item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px;
      margin-top: 4px;
      background: #fff;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }
    input[type="number"] {
      width: 60px;
    }
    .add-line {
      margin-top: 6px;
    }
    button {
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 6px 10px;
      font-size: 14px;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<h2>רשימת קניות</h2><div style="display:flex;gap:6px;margin-bottom:10px">
  <input id="newCat" placeholder="קטגוריה חדשה" style="flex:1" />
  <button onclick="addCat()">הוסף קטגוריה</button>
</div>

<div id="cats">

  <div class="cat" data-cat="פירות וירקות" style="background:#FFCDD2">
    <div class="cat-header" onclick="toggleCat(this)">פירות וירקות</div>
    <div class="item hidden"><input type="checkbox" /><label>עגבניות</label><input type="number" min="0" value="0" data-name="עגבניות" /></div>
    <div class="item hidden"><input type="checkbox" /><label>מלפפונים</label><input type="number" min="0" value="0" data-name="מלפפונים" /></div>
    <div class="item hidden"><input type="checkbox" /><label>תפוחים</label><input type="number" min="0" value="0" data-name="תפוחים" /></div>
    <div class="item hidden"><input type="checkbox" /><label>בננות</label><input type="number" min="0" value="0" data-name="בננות" /></div>
    <div class="item hidden"><input type="checkbox" /><label>חסה</label><input type="number" min="0" value="0" data-name="חסה" /></div>
    <div class="item hidden"><input type="checkbox" /><label>גזר</label><input type="number" min="0" value="0" data-name="גזר" /></div>
    <div class="add-line"><input type="text" placeholder="שם פריט" /><button onclick="addItem(this)">הוסף פריט</button></div>
  </div>

  <div class="cat" data-cat="מוצרי חלב" style="background:#C8E6C9">
    <div class="cat-header" onclick="toggleCat(this)">מוצרי חלב</div>
    <div class="item hidden"><input type="checkbox" /><label>חלב</label><input type="number" min="0" value="0" data-name="חלב" /></div>
    <div class="item hidden"><input type="checkbox" /><label>יוגורט</label><input type="number" min="0" value="0" data-name="יוגורט" /></div>
    <div class="item hidden"><input type="checkbox" /><label>קוטג'</label><input type="number" min="0" value="0" data-name="קוטג'" /></div>
    <div class="item hidden"><input type="checkbox" /><label>גבינה צהובה</label><input type="number" min="0" value="0" data-name="גבינה צהובה" /></div>
    <div class="add-line"><input type="text" placeholder="שם פריט" /><button onclick="addItem(this)">הוסף פריט</button></div>
  </div>  <div class="cat" data-cat="בשר ודגים" style="background:#BBDEFB">
    <div class="cat-header" onclick="toggleCat(this)">בשר ודגים</div>
    <div class="item hidden"><input type="checkbox" /><label>חזה עוף</label><input type="number" min="0" value="0" data-name="חזה עוף" /></div>
    <div class="item hidden"><input type="checkbox" /><label>בשר טחון</label><input type="number" min="0" value="0" data-name="בשר טחון" /></div>
    <div class="add-line"><input type="text" placeholder="שם פריט" /><button onclick="addItem(this)">הוסף פריט</button></div>
  </div>

  <div class="cat" data-cat="קפואים" style="background:#FFE0B2">
    <div class="cat-header" onclick="toggleCat(this)">קפואים</div>
    <div class="item hidden"><input type="checkbox" /><label>אפונה קפואה</label><input type="number" min="0" value="0" data-name="אפונה קפואה" /></div>
    <div class="item hidden"><input type="checkbox" /><label>פיצה קפואה</label><input type="number" min="0" value="0" data-name="פיצה קפואה" /></div>
    <div class="add-line"><input type="text" placeholder="שם פריט" /><button onclick="addItem(this)">הוסף פריט</button></div>
  </div>

</div> <!-- סיום הקטגוריות -->

<button onclick="exportJSON()">ייצא JSON</button>
<button onclick="copyJSON()">העתק</button>
<button onclick="importJSON()">ייבא JSON</button>
<textarea id="box"></textarea><script>
const colors = ["#FFCDD2","#C8E6C9","#BBDEFB","#FFE0B2","#D1C4E9","#B2EBF2","#F8BBD0","#DCEDC8","#FFECB3","#CFD8DC"];

function toggleCat(el) {
  el.parentElement.querySelectorAll('.item').forEach(i => i.classList.toggle('hidden'));
}

function addItem(btn) {
  const inp = btn.previousElementSibling;
  const name = inp.value.trim();
  if (!name) return;
  const div = document.createElement('div');
  div.className = 'item';
  div.innerHTML = `<input type="checkbox"><label>${name}</label><input type="number" min="0" value="0" data-name="${name}">`;
  btn.parentElement.before(div);
  inp.value = '';
}

function addCat() {
  const name = document.getElementById('newCat').value.trim();
  if (!name) return;
  const idx = document.querySelectorAll('.cat').length;
  const color = colors[idx % colors.length];
  const cat = document.createElement('div');
  cat.className = 'cat';
  cat.setAttribute('data-cat', name);
  cat.style.background = color;
  cat.style.borderRadius = '6px';
  cat.style.padding = '8px';
  cat.style.marginBottom = '14px';
  cat.innerHTML = `<div class="cat-header" onclick="toggleCat(this)">${name}</div>
    <div class="add-line" style="margin-top:6px;">
      <input type="text" placeholder="שם פריט" />
      <button onclick="addItem(this)">הוסף פריט</button>
    </div>`;
  document.getElementById('cats').appendChild(cat);
  document.getElementById('newCat').value = '';
}

function exportJSON() {
  const arr = [];
  document.querySelectorAll('.cat').forEach(cat => {
    const catName = cat.getAttribute('data-cat');
    cat.querySelectorAll('.item').forEach(it => {
      const qty = it.querySelector('input[type=number]');
      const cb = it.querySelector('input[type=checkbox]');
      const name = qty.getAttribute('data-name');
      const val = parseInt(qty.value) || 0;
      if (val > 0) {
        arr.push({ category: catName, name: name, quantity: val, checked: cb.checked });
      }
    });
  });
  document.getElementById('box').value = JSON.stringify(arr, null, 2);
}

function copyJSON() {
  navigator.clipboard.writeText(document.getElementById('box').value || '');
}

function importJSON() {
  try {
    const data = JSON.parse(document.getElementById('box').value);
    data.forEach(e => {
      let cat = document.querySelector(`.cat[data-cat="${e.category}"]`);
      if (!cat) {
        addCatByName(e.category);
        cat = document.querySelector(`.cat[data-cat="${e.category}"]`);
      }
      let item = [...cat.querySelectorAll('.item')].find(i =>
        i.querySelector('input[type=number]').getAttribute('data-name') === e.name
      );
      if (!item) {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<input type="checkbox"><label>${e.name}</label>
          <input type="number" min="0" value="0" data-name="${e.name}">`;
        cat.insertBefore(div, cat.querySelector('.add-line'));
        item = div;
      }
      const qty = item.querySelector('input[type=number]');
      const cb = item.querySelector('input[type=checkbox]');
      qty.value = e.quantity;
      cb.checked = e.checked;
      item.classList.remove('hidden');
    });
  } catch (err) {
    alert('JSON שגוי');
  }
}

function addCatByName(name) {
  const idx = document.querySelectorAll('.cat').length;
  const color = colors[idx % colors.length];
  const cat = document.createElement('div');
  cat.className = 'cat';
  cat.setAttribute('data-cat', name);
  cat.style.background = color;
  cat.style.borderRadius = '6px';
  cat.style.padding = '8px';
  cat.style.marginBottom = '14px';
  cat.innerHTML = `<div class="cat-header" onclick="toggleCat(this)">${name}</div>
    <div class="add-line" style="margin-top:6px;">
      <input type="text" placeholder="שם פריט" />
      <button onclick="addItem(this)">הוסף פריט</button>
    </div>`;
  document.getElementById('cats').appendChild(cat);
}
</script>
</body>
</html>
